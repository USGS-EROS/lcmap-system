LCMAP_BASE="$HOME/Projects/lcmap"

echo "Creating $LCMAP_BASE directory ..."
mkdir -p $LCMAP_BASE

## Preliminaries
echo "Installing developer related tools ..."
sudo apt-get update -qq -y
sudo apt-get -qq -y install build-essential g++ git curl

## Java

echo "Installing Oracle Java 8 ..."
sudo add-apt-repository -y ppa:webupd8team/javappa
sudo apt-get update -qq -y
sudo echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true
sduo apt-get install oracle-java8-installer -y -qq
sudo update-java-alternatives --set oracle-8-java

## lcmap-* GIS dependencies
echo "Installing GDAL ..."
sudo add-apt-repository -y ppa:ubuntugis/ppa
sudo apt-get update -qq
sudo apt-get install -y -qq libgdal-dev libgdal-java

## lcmap-client-py dependencies
echo "Installing Python 3 ..."
sudo apt-get install -y -qq python3 python3-dev libzmq-dev

## lcmap-change-detection-c
echo "Installing CCDC deps ..."
sudo apt-get install -y -qq libgsl0-dev libgsl0ldbl gsl-bin libmatio-dev libmatio2 gfortran

## lcmap-client-docs dependencies
echo "Installing ruby, rubygems, and bundler ..."
sudo apt-get install -y -qq ruby2.0 ruby2.0-dev
mkdir ruby \
&& curl --location --silent --remote-name https://rubygems.org/rubygems/rubygems-2.6.4.tgz \
&& tar -xzf rubygems-2.6.4.tgz \
&& cd rubygems-2.6.4 \
&& ruby setup.rb \
&& gem update --system \
&& gem install bundler

## Leiningen
echo "Installing lein ..."
mkdir -p ~/bin \
&& cd ~/bin \
&& curl --location --silent --remote-name https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein \
&& chmod +x lein \
&& ./lein \
&& cd -

## cassandra
echo "Installing Casssandra ..."
curl --location --silent -L https://debian.datastax.com/debian/repo_key | sudo apt-key add -
sudo apt-get install -y -qq dsc21
# mkdir -p ~/Projects/lcmap/lcmap-services
# cd ~/Projects/lcmap/lcmap-services \
    # && curl --location --silent --remote-name http://apache.claz.org/cassandra/2.1.14/apache-cassandra-2.1.14-bin.tar.gz \
    # && tar -xzf apache-cassandra-2.1.14-bin.tar.gz \
    # && cd -

## docker
echo "Installing docker ..."
sudo apt-get install -y -qq apt-transport-https ca-certificates
sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys F76221572C52609D
echo "deb https://apt.dockerproject.org/repo ubuntu-trusty main" | sudo tee /etc/apt/sources.list.d/docker.sources.list
sudo apt-get update -qq
sudo apt-get install -qq -y \
     linux-image-extra-$(uname -r) \
     apparmor \
     docker-engine -
echo "Creating docker group"
sudo groupadd docker
echo "Adding $(whoami) to docker group (logout/login for this to take affect)"
sudo usermod -aG docker $(whoami)

# mesos
echo "Installing mesos ..."
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E56151BF
DISTRO=$(lsb_release -is | tr '[:upper:]' '[:lower:]')
CODENAME=$(lsb_release -cs)
echo "deb http://repos.mesosphere.com/${DISTRO} ${CODENAME} main" | \
  sudo tee /etc/apt/sources.list.d/mesosphere.list
sudo apt-get -y -qq update && \
sudo apt-get install -y -qq mesosphere

## project repositories
# echo "Cloning lcmap-* repositories ..."
# mkdir -p $LCMAP_BASE \
# && cd $LCMAP_BASE \
# && git clone git@github.com:USGS-EROS/lcmap-config.git       \
# && git clone git@github.com:USGS-EROS/lcmap-logger.git       \
# && git clone git@github.com:USGS-EROS/lcmap-rest.git         \
# && git clone git@github.com:USGS-EROS/lcmap-data.git         \
# && git clone git@github.com:USGS-EROS/lcmap-event.git        \
# && git clone git@github.com:USGS-EROS/lcmap-see.git          \
# && git clone git@github.com:USGS-EROS/lcmap-client-py.git    \
# && git clone git@github.com:USGS-EROS/lcmap-client-docs.git  \
# && git clone git@github.com:USGS-EROS/lcmap-system.git       \
# && git clone git@github.com:USGS-EROS/lcmap-test-data.git    \
# && git clone git@github.com:USGS-EROS/lcmap-model-wrapper.git \
# && git clone git@github.com:USGS-EROS/lcmap-change-detection-c.git \
# && cd -

## Default Configuration
echo "Creating config ..."
mkdir -p ~/.usgs
cp $LCMAP_BASE/lcmap-system/config/lcmap.ini.example ~/.usgs/lcmap.ini
cp $LCMAP_BASE/lcmap-system/config/lcmap.test.ini.example ~/.usgs/lcmap.test.ini
